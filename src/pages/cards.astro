---
import Layout from '@layouts/Layout.astro';
import creditCards from '@data/cards.json';
import CreditCardReact from '../components/CreditCard';// React version

import Icons from "@icons/Icons.astro";
---

<Layout>
  <header class="mb-8">
    <h1 class="text-2xl font-bold dark:text-white">Cards</h1>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Lista de tarjetas con sus estilos.
    </p>
  </header>

  <div class="flex flex-col-reverse md:grid grid-cols-2 gap-8">



 

  <ul class="flex flex-col gap-4" id="cards-list">
    {creditCards.map((producto, index) => (
      <button
        class="credit-card-selector border p-3 flex justify-between items-center gap-2 rounded-lg shadow-md dark:text-white font-bold"
        data-product={JSON.stringify(producto)}
      >

      <div>
        <span class="text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm bg-[#CBED94] text-black">
          {producto.Producto.Id}{producto.Producto.SubproductoId}
        </span>
          {producto.Producto.SubproductoNombre}
      </div>

            <Icons
              icon="angle-small-right"/>


      </button>
    ))}
  </ul>

   <section  id="card-container" class="mb-8">
    <CreditCardReact
      id="Z"
      SubproductoNombre="Cordobesa débito MasterCard"
      backgroundColor="#CFCDBA"
      textColor="#022321"
      logoColor="#D9D8C8"
      logoCordobesa="Color"
      SubproductoId="2"
      Marca="MasterCard"
      client:load
    />

  </section>

  </div>

</Layout>

<script type="module">
  const cards = document.querySelectorAll(".credit-card-selector");
  let selectedCard = null;

  function selectCard(card) {
    const rawData = card.dataset.product;
    const json = JSON.parse(rawData);

    // Enviar evento a React
    const event = new CustomEvent("update-card", {
      detail: json
    });
    window.dispatchEvent(event);

    // Actualizar clase visual
    if (selectedCard) {
      selectedCard.classList.remove("selected");
    }
    card.classList.add("selected");
    selectedCard = card;
  }

  // Listeners
  cards.forEach(card => {
    card.addEventListener("click", () => selectCard(card));
  });

  // ✅ Seleccionar el primero automáticamente al cargar
  if (cards.length > 0) {
    selectCard(cards[0]);
  }
</script>



<style>
  .credit-card-selector.selected {
    outline: 2px solid #4F46E5; /* Indigo */
    background-color: rgba(79, 70, 229, 0.1);
  }
</style>